<% layout("owner/adminLayout") %>

<% pageTitle = "Messages" %>
<% pageSubtitle = "All contact form submissions" %>

<div class="table-glass p-0 mb-4">
  <div class="table-responsive">
    <table class="table table-hover mb-0 align-middle">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Subject</th>
          <th>Date</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>

      <tbody>
        <% if (!messages || messages.length === 0) { %>
          <tr>
            <td colspan="5" class="text-center text-muted py-4">
              No messages found.
            </td>
          </tr>
        <% } else { %>

          <% messages.forEach(msg => { %>
            <tr>
              <td><%= msg.name %></td>
              <td><%= msg.email %></td>
              <td><%= msg.subject %></td>
              <td><%= msg.sentAt.toLocaleString() %></td>

              <td class="text-end">

                <!-- View button -->
                <a href="/admin/messages/<%= msg._id %>/view" 
                   class="btn btn-sm btn-outline-primary me-1">
                  View
                </a>

                <!-- Delete button -->
                <form 
                  action="/admin/messages/<%= msg._id %>/delete?_method=DELETE"
                  method="POST" 
                  class="d-inline"
                  onsubmit="return confirm('Delete this message?');"
                >
                  <button class="btn btn-sm btn-outline-danger">
                    Delete
                  </button>
                </form>

              </td>
            </tr>
          <% }) %>

        <% } %>
      </tbody>
    </table>
  </div>
</div>
